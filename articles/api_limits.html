<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>API limits and loops • meteospain</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="API limits and loops">
<meta property="og:description" content="meteospain">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">meteospain</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.0.4</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li class="divider">
    </li>
<li class="dropdown-header">Services</li>
    <li>
      <a href="../articles/aemet.html">AEMET service</a>
    </li>
    <li>
      <a href="../articles/meteocat.html">MeteoCat service</a>
    </li>
    <li>
      <a href="../articles/meteogalicia.html">MeteoGalicia service</a>
    </li>
    <li>
      <a href="../articles/ria.html">RIA service</a>
    </li>
    <li>
      <a href="../articles/meteoclimatic.html">Meteoclimatic service</a>
    </li>
    <li class="divider">
    </li>
<li class="dropdown-header">Workflows</li>
    <li>
      <a href="../articles/api_limits.html">API limits and loops</a>
    </li>
    <li>
      <a href="../articles/compatibility.html">Compatibility between services</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/emf-creaf/meteospain/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="api_limits_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>API limits and loops</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/emf-creaf/meteospain/blob/HEAD/vignettes/api_limits.Rmd" class="external-link"><code>vignettes/api_limits.Rmd</code></a></small>
      <div class="hidden name"><code>api_limits.Rmd</code></div>

    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://emf-creaf.github.io/meteospain/">meteospain</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-spatial.github.io/sf/" class="external-link">sf</a></span><span class="op">)</span>
<span class="co">#&gt; Linking to GEOS 3.10.2, GDAL 3.4.2, PROJ 8.2.1; sf_use_s2() is TRUE</span></code></pre></div>
<p>The following APIs impose a period limit in the data retrieved, not allowing querying more than the predetermined period in each API.</p>
<div class="section level2">
<h2 id="aemet-api">AEMET API<a class="anchor" aria-label="anchor" href="#aemet-api"></a>
</h2>
<p>AEMET API limit the daily data download to 31 days:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># aemet api has a limit for 31 days:</span>
<span class="fu"><a href="../reference/get_meteo_from.html">get_meteo_from</a></span><span class="op">(</span>
  <span class="st">'aemet'</span>,
  <span class="fu"><a href="../reference/services_options.html">aemet_options</a></span><span class="op">(</span>
    api_key <span class="op">=</span> <span class="fu">keyring</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/keyring/man/key_get.html" class="external-link">key_get</a></span><span class="op">(</span><span class="st">'aemet'</span><span class="op">)</span>,
    resolution <span class="op">=</span> <span class="st">'daily'</span>,
    start_date <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="st">'1990-01-01'</span><span class="op">)</span>,
    end_date <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="st">'1990-12-31'</span><span class="op">)</span>
  <span class="op">)</span>
<span class="op">)</span>
<span class="co">#&gt; Error in api_function(options): 404:</span>
<span class="co">#&gt; AEMET API returned no data: El rango de fechas no puede ser superior a 31 dias</span></code></pre></div>
<p>This means that with one call to <code>get_meteo_from</code> to the AEMET service, one can only download 31 days of data. If the period needed is bigger than that, one option is performing all the calls necessary and join the results:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">res_1990_jan</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_meteo_from.html">get_meteo_from</a></span><span class="op">(</span>
  <span class="st">'aemet'</span>,
  <span class="fu"><a href="../reference/services_options.html">aemet_options</a></span><span class="op">(</span>
    api_key <span class="op">=</span> <span class="fu">keyring</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/keyring/man/key_get.html" class="external-link">key_get</a></span><span class="op">(</span><span class="st">'aemet'</span><span class="op">)</span>,
    resolution <span class="op">=</span> <span class="st">'daily'</span>,
    start_date <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="st">'1990-01-01'</span><span class="op">)</span>,
    end_date <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="st">'1990-01-31'</span><span class="op">)</span>
  <span class="op">)</span>
<span class="op">)</span>
<span class="co">#&gt; <span style="color: #BBBB00; font-weight: bold;">© AEMET. Autorizado el uso de la información y su reproducción citando a AEMET como autora de la misma.</span></span>
<span class="co">#&gt; <span style="color: #0000BB; font-weight: bold; text-decoration: underline;">http://www.aemet.es/es/nota_legal</span></span>

<span class="va">res_1990_feb</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_meteo_from.html">get_meteo_from</a></span><span class="op">(</span>
  <span class="st">'aemet'</span>,
  <span class="fu"><a href="../reference/services_options.html">aemet_options</a></span><span class="op">(</span>
    api_key <span class="op">=</span> <span class="fu">keyring</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/keyring/man/key_get.html" class="external-link">key_get</a></span><span class="op">(</span><span class="st">'aemet'</span><span class="op">)</span>,
    resolution <span class="op">=</span> <span class="st">'daily'</span>,
    start_date <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="st">'1990-02-01'</span><span class="op">)</span>,
    end_date <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="st">'1990-02-28'</span><span class="op">)</span>
  <span class="op">)</span>
<span class="op">)</span>
<span class="co">#&gt; <span style="color: #BBBB00; font-weight: bold;">© AEMET. Autorizado el uso de la información y su reproducción citando a AEMET como autora de la misma.</span></span>
<span class="co">#&gt; <span style="color: #0000BB; font-weight: bold; text-decoration: underline;">http://www.aemet.es/es/nota_legal</span></span>

<span class="va">res</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="va">res_1990_jan</span>, <span class="va">res_1990_feb</span><span class="op">)</span>
<span class="va">res</span>
<span class="co">#&gt; Simple feature collection with 7015 features and 12 fields</span>
<span class="co">#&gt; Geometry type: POINT</span>
<span class="co">#&gt; Dimension:     XY</span>
<span class="co">#&gt; Bounding box:  xmin: -17.532 ymin: 27.4908 xmax: 4.1256 ymax: 43.3401</span>
<span class="co">#&gt; Geodetic CRS:  WGS 84</span>
<span class="co">#&gt; <span style="color: #949494;"># A tibble: 7,015 × 13</span></span>
<span class="co">#&gt;    timestamp           service station_id station_name station_province altitude</span>
<span class="co">#&gt;  <span style="color: #BCBCBC;">*</span> <span style="color: #949494; font-style: italic;">&lt;dttm&gt;</span>              <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                 <span style="color: #949494;">[m]</span></span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> 1990-01-01 <span style="color: #949494;">00:00:00</span> aemet   0002I      <span style="color: #949494;">"</span>VANDELLÒS … TARRAGONA              32</span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> 1990-01-01 <span style="color: #949494;">00:00:00</span> aemet   0016A      <span style="color: #949494;">"</span>REUS AEROP… TARRAGONA              71</span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> 1990-01-01 <span style="color: #949494;">00:00:00</span> aemet   0076       <span style="color: #949494;">"</span>BARCELONA … BARCELONA               4</span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> 1990-01-01 <span style="color: #949494;">00:00:00</span> aemet   0200E      <span style="color: #949494;">"</span>BARCELONA,… BARCELONA             408</span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> 1990-01-01 <span style="color: #949494;">00:00:00</span> aemet   0229I      <span style="color: #949494;">"</span>SABADELL A… BARCELONA             146</span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> 1990-01-01 <span style="color: #949494;">00:00:00</span> aemet   0324A      <span style="color: #949494;">"</span>RIPOLL<span style="color: #949494;">"</span>     GIRONA                675</span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> 1990-01-01 <span style="color: #949494;">00:00:00</span> aemet   0367       <span style="color: #949494;">"</span>GIRONA AER… GIRONA                143</span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> 1990-01-01 <span style="color: #949494;">00:00:00</span> aemet   1014       <span style="color: #949494;">"</span>HONDARRIBI… GIPUZKOA                4</span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> 1990-01-01 <span style="color: #949494;">00:00:00</span> aemet   1024E      <span style="color: #949494;">"</span>DONOSTIA/S… GIPUZKOA              251</span>
<span class="co">#&gt; <span style="color: #BCBCBC;">10</span> 1990-01-01 <span style="color: #949494;">00:00:00</span> aemet   1082       <span style="color: #949494;">"</span>BILBAO AER… BIZKAIA                42</span>
<span class="co">#&gt; <span style="color: #949494;"># … with 7,005 more rows, and 7 more variables: mean_temperature [°C],</span></span>
<span class="co">#&gt; <span style="color: #949494;">#   min_temperature [°C], max_temperature [°C], precipitation [L/m^2],</span></span>
<span class="co">#&gt; <span style="color: #949494;">#   mean_wind_speed [m/s], insolation [h], geometry &lt;POINT [°]&gt;</span></span></code></pre></div>
<p>While for short periods this can be easily done, when needing long periods (years, decades), this can be tedious and prone to error (or at least involves a lot of <em>copy&amp;paste</em> and generate longer scripts).<br>
To avoid this, we can use loops, both in a tidyverse way (<code><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">purrr::map</a></code>) or in a more classic approach (<code>for</code>). For both ways, the first thing to do is create the vectors of dates to retrieve:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># First, we prepare the date vectors, with the start and end dates.</span>
<span class="va">start_dates</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="st">'1990-01-01'</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="st">'1990-06-01'</span><span class="op">)</span>, <span class="st">'months'</span><span class="op">)</span>
<span class="va">end_dates</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="st">'1990-02-01'</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="st">'1990-07-01'</span><span class="op">)</span>, <span class="st">'months'</span><span class="op">)</span> <span class="op">-</span> <span class="fl">1</span>

<span class="co"># Both vectors must have the same length</span>
<span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">start_dates</span><span class="op">)</span> <span class="op">==</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">end_dates</span><span class="op">)</span>
<span class="co">#&gt; [1] TRUE</span>

<span class="co"># lets see them</span>
<span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="va">start_dates</span>, <span class="va">end_dates</span><span class="op">)</span>
<span class="co">#&gt;   start_dates  end_dates</span>
<span class="co">#&gt; 1  1990-01-01 1990-01-31</span>
<span class="co">#&gt; 2  1990-02-01 1990-02-28</span>
<span class="co">#&gt; 3  1990-03-01 1990-03-31</span>
<span class="co">#&gt; 4  1990-04-01 1990-04-30</span>
<span class="co">#&gt; 5  1990-05-01 1990-05-31</span>
<span class="co">#&gt; 6  1990-06-01 1990-06-30</span></code></pre></div>
<div class="section level3">
<h3 id="tidyverse-loop">tidyverse loop<a class="anchor" aria-label="anchor" href="#tidyverse-loop"></a>
</h3>
<p>We are gonna use <code><a href="https://purrr.tidyverse.org/reference/map2.html" class="external-link">purrr::map2_dfr</a></code>, to iterate both date vectors at the same time and return a data frame with all the results directly:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># tidyverse map</span>
<span class="va">res_tidyverse</span> <span class="op">&lt;-</span>
  <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map2.html" class="external-link">map2_dfr</a></span><span class="op">(</span>
    .x <span class="op">=</span> <span class="va">start_dates</span>, .y <span class="op">=</span> <span class="va">end_dates</span>,
    .f <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">start_date</span>, <span class="va">end_date</span><span class="op">)</span> <span class="op">{</span>
      <span class="va">res</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_meteo_from.html">get_meteo_from</a></span><span class="op">(</span>
        <span class="st">'aemet'</span>,
        <span class="fu"><a href="../reference/services_options.html">aemet_options</a></span><span class="op">(</span>
          api_key <span class="op">=</span> <span class="fu">keyring</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/keyring/man/key_get.html" class="external-link">key_get</a></span><span class="op">(</span><span class="st">'aemet'</span><span class="op">)</span>,
          resolution <span class="op">=</span> <span class="st">'daily'</span>,
          start_date <span class="op">=</span> <span class="va">start_date</span>,
          end_date <span class="op">=</span> <span class="va">end_date</span>
        <span class="op">)</span>
      <span class="op">)</span>
      <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">res</span><span class="op">)</span>
    <span class="op">}</span>
  <span class="op">)</span>
<span class="co">#&gt; <span style="color: #BBBB00; font-weight: bold;">© AEMET. Autorizado el uso de la información y su reproducción citando a AEMET como autora de la misma.</span></span>
<span class="co">#&gt; <span style="color: #0000BB; font-weight: bold; text-decoration: underline;">http://www.aemet.es/es/nota_legal</span></span>
<span class="co">#&gt; <span style="color: #BBBB00; font-weight: bold;">© AEMET. Autorizado el uso de la información y su reproducción citando a AEMET como autora de la misma.</span></span>
<span class="co">#&gt; <span style="color: #0000BB; font-weight: bold; text-decoration: underline;">http://www.aemet.es/es/nota_legal</span></span>
<span class="co">#&gt; <span style="color: #BBBB00; font-weight: bold;">© AEMET. Autorizado el uso de la información y su reproducción citando a AEMET como autora de la misma.</span></span>
<span class="co">#&gt; <span style="color: #0000BB; font-weight: bold; text-decoration: underline;">http://www.aemet.es/es/nota_legal</span></span>
<span class="co">#&gt; <span style="color: #BBBB00; font-weight: bold;">© AEMET. Autorizado el uso de la información y su reproducción citando a AEMET como autora de la misma.</span></span>
<span class="co">#&gt; <span style="color: #0000BB; font-weight: bold; text-decoration: underline;">http://www.aemet.es/es/nota_legal</span></span>

<span class="va">res_tidyverse</span>
<span class="co">#&gt; Simple feature collection with 21553 features and 12 fields</span>
<span class="co">#&gt; Geometry type: POINT</span>
<span class="co">#&gt; Dimension:     XY</span>
<span class="co">#&gt; Bounding box:  xmin: -17.532 ymin: 27.4908 xmax: 4.1256 ymax: 43.3401</span>
<span class="co">#&gt; Geodetic CRS:  WGS 84</span>
<span class="co">#&gt; <span style="color: #949494;"># A tibble: 21,553 × 13</span></span>
<span class="co">#&gt;    timestamp           service station_id station_name station_province altitude</span>
<span class="co">#&gt;  <span style="color: #BCBCBC;">*</span> <span style="color: #949494; font-style: italic;">&lt;dttm&gt;</span>              <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                 <span style="color: #949494;">[m]</span></span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> 1990-01-01 <span style="color: #949494;">00:00:00</span> aemet   0002I      <span style="color: #949494;">"</span>VANDELLÒS … TARRAGONA              32</span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> 1990-01-01 <span style="color: #949494;">00:00:00</span> aemet   0016A      <span style="color: #949494;">"</span>REUS AEROP… TARRAGONA              71</span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> 1990-01-01 <span style="color: #949494;">00:00:00</span> aemet   0076       <span style="color: #949494;">"</span>BARCELONA … BARCELONA               4</span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> 1990-01-01 <span style="color: #949494;">00:00:00</span> aemet   0200E      <span style="color: #949494;">"</span>BARCELONA,… BARCELONA             408</span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> 1990-01-01 <span style="color: #949494;">00:00:00</span> aemet   0229I      <span style="color: #949494;">"</span>SABADELL A… BARCELONA             146</span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> 1990-01-01 <span style="color: #949494;">00:00:00</span> aemet   0324A      <span style="color: #949494;">"</span>RIPOLL<span style="color: #949494;">"</span>     GIRONA                675</span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> 1990-01-01 <span style="color: #949494;">00:00:00</span> aemet   0367       <span style="color: #949494;">"</span>GIRONA AER… GIRONA                143</span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> 1990-01-01 <span style="color: #949494;">00:00:00</span> aemet   1014       <span style="color: #949494;">"</span>HONDARRIBI… GIPUZKOA                4</span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> 1990-01-01 <span style="color: #949494;">00:00:00</span> aemet   1024E      <span style="color: #949494;">"</span>DONOSTIA/S… GIPUZKOA              251</span>
<span class="co">#&gt; <span style="color: #BCBCBC;">10</span> 1990-01-01 <span style="color: #949494;">00:00:00</span> aemet   1082       <span style="color: #949494;">"</span>BILBAO AER… BIZKAIA                42</span>
<span class="co">#&gt; <span style="color: #949494;"># … with 21,543 more rows, and 7 more variables: mean_temperature [°C],</span></span>
<span class="co">#&gt; <span style="color: #949494;">#   min_temperature [°C], max_temperature [°C], precipitation [L/m^2],</span></span>
<span class="co">#&gt; <span style="color: #949494;">#   mean_wind_speed [m/s], insolation [h], geometry &lt;POINT [°]&gt;</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="for-loop">for loop<a class="anchor" aria-label="anchor" href="#for-loop"></a>
</h3>
<p>We use <code>base::for</code>, iterating by the index of the dates vectors:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># base for loop</span>
<span class="va">res_for</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="op">)</span>

<span class="kw">for</span> <span class="op">(</span><span class="va">index</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_along</a></span><span class="op">(</span><span class="va">start_dates</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">temp_res</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_meteo_from.html">get_meteo_from</a></span><span class="op">(</span>
    <span class="st">'aemet'</span>,
    <span class="fu"><a href="../reference/services_options.html">aemet_options</a></span><span class="op">(</span>
      api_key <span class="op">=</span> <span class="fu">keyring</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/keyring/man/key_get.html" class="external-link">key_get</a></span><span class="op">(</span><span class="st">'aemet'</span><span class="op">)</span>,
      resolution <span class="op">=</span> <span class="st">'daily'</span>,
      start_date <span class="op">=</span> <span class="va">start_dates</span><span class="op">[</span><span class="va">index</span><span class="op">]</span>,
      end_date <span class="op">=</span> <span class="va">end_dates</span><span class="op">[</span><span class="va">index</span><span class="op">]</span>
    <span class="op">)</span>
  <span class="op">)</span>
  
  <span class="va">res_for</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="va">res_for</span>, <span class="va">temp_res</span><span class="op">)</span>
<span class="op">}</span>

<span class="va">res_for</span>
<span class="co">#&gt; Simple feature collection with 21553 features and 12 fields</span>
<span class="co">#&gt; Geometry type: POINT</span>
<span class="co">#&gt; Dimension:     XY</span>
<span class="co">#&gt; Bounding box:  xmin: -17.532 ymin: 27.4908 xmax: 4.1256 ymax: 43.3401</span>
<span class="co">#&gt; Geodetic CRS:  WGS 84</span>
<span class="co">#&gt; <span style="color: #949494;"># A tibble: 21,553 × 13</span></span>
<span class="co">#&gt;    timestamp           service station_id station_name station_province altitude</span>
<span class="co">#&gt;  <span style="color: #BCBCBC;">*</span> <span style="color: #949494; font-style: italic;">&lt;dttm&gt;</span>              <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                 <span style="color: #949494;">[m]</span></span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> 1990-01-01 <span style="color: #949494;">00:00:00</span> aemet   0002I      <span style="color: #949494;">"</span>VANDELLÒS … TARRAGONA              32</span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> 1990-01-01 <span style="color: #949494;">00:00:00</span> aemet   0016A      <span style="color: #949494;">"</span>REUS AEROP… TARRAGONA              71</span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> 1990-01-01 <span style="color: #949494;">00:00:00</span> aemet   0076       <span style="color: #949494;">"</span>BARCELONA … BARCELONA               4</span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> 1990-01-01 <span style="color: #949494;">00:00:00</span> aemet   0200E      <span style="color: #949494;">"</span>BARCELONA,… BARCELONA             408</span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> 1990-01-01 <span style="color: #949494;">00:00:00</span> aemet   0229I      <span style="color: #949494;">"</span>SABADELL A… BARCELONA             146</span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> 1990-01-01 <span style="color: #949494;">00:00:00</span> aemet   0324A      <span style="color: #949494;">"</span>RIPOLL<span style="color: #949494;">"</span>     GIRONA                675</span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> 1990-01-01 <span style="color: #949494;">00:00:00</span> aemet   0367       <span style="color: #949494;">"</span>GIRONA AER… GIRONA                143</span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> 1990-01-01 <span style="color: #949494;">00:00:00</span> aemet   1014       <span style="color: #949494;">"</span>HONDARRIBI… GIPUZKOA                4</span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> 1990-01-01 <span style="color: #949494;">00:00:00</span> aemet   1024E      <span style="color: #949494;">"</span>DONOSTIA/S… GIPUZKOA              251</span>
<span class="co">#&gt; <span style="color: #BCBCBC;">10</span> 1990-01-01 <span style="color: #949494;">00:00:00</span> aemet   1082       <span style="color: #949494;">"</span>BILBAO AER… BIZKAIA                42</span>
<span class="co">#&gt; <span style="color: #949494;"># … with 21,543 more rows, and 7 more variables: mean_temperature [°C],</span></span>
<span class="co">#&gt; <span style="color: #949494;">#   min_temperature [°C], max_temperature [°C], precipitation [L/m^2],</span></span>
<span class="co">#&gt; <span style="color: #949494;">#   mean_wind_speed [m/s], insolation [h], geometry &lt;POINT [°]&gt;</span></span></code></pre></div>
<p>Both methods return identical results:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># both are identical</span>
<span class="fu"><a href="https://rdrr.io/r/base/identical.html" class="external-link">identical</a></span><span class="op">(</span><span class="va">res_tidyverse</span>, <span class="va">res_for</span><span class="op">)</span>
<span class="co">#&gt; [1] TRUE</span></code></pre></div>
<blockquote>
<p>In a loop, no matter if a <code><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">purrr::map</a></code> or a <code>for</code> loop, each iteration will connect with the API, consuming connections from the user quota. Take this into consideration when creating loops for longer periods, as you can reach your API request limits for the day/month… (it depends on the service API).</p>
</blockquote>
</div>
</div>
<div class="section level2">
<h2 id="meteocat-api">MeteoCat API<a class="anchor" aria-label="anchor" href="#meteocat-api"></a>
</h2>
<p>When using MeteoCat in <code>daily</code>, <code>monthly</code> and <code>yearly</code> there are restrictions on the period that can be accessed.</p>
<div class="section level3">
<h3 id="daily">
<code>daily</code><a class="anchor" aria-label="anchor" href="#daily"></a>
</h3>
<p><code>daily</code> always returns the whole month the date selected is in, i.e. for <code>start_date = as.Date('2020-04-10')</code> it will return all days in April, 2020:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">api_options</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/services_options.html">meteocat_options</a></span><span class="op">(</span>
  <span class="st">'daily'</span>, start_date <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="st">'2020-04-10'</span><span class="op">)</span>,
  api_key <span class="op">=</span> <span class="fu">keyring</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/keyring/man/key_get.html" class="external-link">key_get</a></span><span class="op">(</span><span class="st">'meteocat'</span><span class="op">)</span>
<span class="op">)</span>
<span class="va">april_2020</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_meteo_from.html">get_meteo_from</a></span><span class="op">(</span><span class="st">'meteocat'</span>, <span class="va">api_options</span><span class="op">)</span>
<span class="co">#&gt; <span style="color: #BBBB00; font-weight: bold;">Data provided by meteo.cat © Servei Meteorològic de Catalunya</span></span>
<span class="co">#&gt; <span style="color: #0000BB; font-weight: bold; text-decoration: underline;">https://www.meteo.cat/wpweb/avis-legal/#info</span></span>
<span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">april_2020</span><span class="op">$</span><span class="va">timestamp</span><span class="op">)</span>
<span class="co">#&gt;  [1] "2020-04-01 UTC" "2020-04-02 UTC" "2020-04-03 UTC" "2020-04-04 UTC"</span>
<span class="co">#&gt;  [5] "2020-04-05 UTC" "2020-04-06 UTC" "2020-04-07 UTC" "2020-04-08 UTC"</span>
<span class="co">#&gt;  [9] "2020-04-09 UTC" "2020-04-10 UTC" "2020-04-11 UTC" "2020-04-12 UTC"</span>
<span class="co">#&gt; [13] "2020-04-13 UTC" "2020-04-14 UTC" "2020-04-15 UTC" "2020-04-16 UTC"</span>
<span class="co">#&gt; [17] "2020-04-17 UTC" "2020-04-18 UTC" "2020-04-19 UTC" "2020-04-20 UTC"</span>
<span class="co">#&gt; [21] "2020-04-21 UTC" "2020-04-22 UTC" "2020-04-23 UTC" "2020-04-24 UTC"</span>
<span class="co">#&gt; [25] "2020-04-25 UTC" "2020-04-26 UTC" "2020-04-27 UTC" "2020-04-28 UTC"</span>
<span class="co">#&gt; [29] "2020-04-29 UTC" "2020-04-30 UTC"</span></code></pre></div>
<p>This means that if we want more than one month, we need to use loops in a similar way as described previously for AEMET:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">start_dates</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="st">'2020-01-01'</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="st">'2020-04-01'</span><span class="op">)</span>, <span class="st">'months'</span><span class="op">)</span>
<span class="co"># tidyverse map</span>
<span class="va">meteocat_2020q1_tidyverse</span> <span class="op">&lt;-</span>
  <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">map_dfr</a></span><span class="op">(</span>
    .x <span class="op">=</span> <span class="va">start_dates</span>,
    .f <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">start_date</span><span class="op">)</span> <span class="op">{</span>
      <span class="va">res</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_meteo_from.html">get_meteo_from</a></span><span class="op">(</span>
        <span class="st">'meteocat'</span>,
        <span class="fu"><a href="../reference/services_options.html">meteocat_options</a></span><span class="op">(</span>
          api_key <span class="op">=</span> <span class="fu">keyring</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/keyring/man/key_get.html" class="external-link">key_get</a></span><span class="op">(</span><span class="st">'meteocat'</span><span class="op">)</span>,
          resolution <span class="op">=</span> <span class="st">'daily'</span>,
          start_date <span class="op">=</span> <span class="va">start_date</span>
        <span class="op">)</span>
      <span class="op">)</span>
      <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">res</span><span class="op">)</span>
    <span class="op">}</span>
  <span class="op">)</span>
<span class="co">#&gt; <span style="color: #BBBB00; font-weight: bold;">Data provided by meteo.cat © Servei Meteorològic de Catalunya</span></span>
<span class="co">#&gt; <span style="color: #0000BB; font-weight: bold; text-decoration: underline;">https://www.meteo.cat/wpweb/avis-legal/#info</span></span>
<span class="co">#&gt; <span style="color: #BBBB00; font-weight: bold;">Data provided by meteo.cat © Servei Meteorològic de Catalunya</span></span>
<span class="co">#&gt; <span style="color: #0000BB; font-weight: bold; text-decoration: underline;">https://www.meteo.cat/wpweb/avis-legal/#info</span></span>
<span class="co">#&gt; <span style="color: #BBBB00; font-weight: bold;">Data provided by meteo.cat © Servei Meteorològic de Catalunya</span></span>
<span class="co">#&gt; <span style="color: #0000BB; font-weight: bold; text-decoration: underline;">https://www.meteo.cat/wpweb/avis-legal/#info</span></span>
<span class="co">#&gt; <span style="color: #BBBB00; font-weight: bold;">Data provided by meteo.cat © Servei Meteorològic de Catalunya</span></span>
<span class="co">#&gt; <span style="color: #0000BB; font-weight: bold; text-decoration: underline;">https://www.meteo.cat/wpweb/avis-legal/#info</span></span>
<span class="va">meteocat_2020q1_tidyverse</span>
<span class="co">#&gt; Simple feature collection with 22627 features and 16 fields</span>
<span class="co">#&gt; Geometry type: POINT</span>
<span class="co">#&gt; Dimension:     XY</span>
<span class="co">#&gt; Bounding box:  xmin: 0.30565 ymin: 40.55786 xmax: 3.18165 ymax: 42.77011</span>
<span class="co">#&gt; Geodetic CRS:  WGS 84</span>
<span class="co">#&gt; <span style="color: #949494;"># A tibble: 22,627 × 17</span></span>
<span class="co">#&gt;    timestamp           service station_id station_name station_province altitude</span>
<span class="co">#&gt;  <span style="color: #BCBCBC;">*</span> <span style="color: #949494; font-style: italic;">&lt;dttm&gt;</span>              <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                 <span style="color: #949494;">[m]</span></span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> 2020-01-01 <span style="color: #949494;">00:00:00</span> meteoc… C6         Castellnou … Lleida               264 </span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> 2020-01-01 <span style="color: #949494;">00:00:00</span> meteoc… C7         Tàrrega      Lleida               427 </span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> 2020-01-01 <span style="color: #949494;">00:00:00</span> meteoc… C8         Cervera      Lleida               554 </span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> 2020-01-01 <span style="color: #949494;">00:00:00</span> meteoc… C9         Mas de Barb… Tarragona            240 </span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> 2020-01-01 <span style="color: #949494;">00:00:00</span> meteoc… CC         Orís         Barcelona            626 </span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> 2020-01-01 <span style="color: #949494;">00:00:00</span> meteoc… CD         la Seu d'Ur… Lleida               849 </span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> 2020-01-01 <span style="color: #949494;">00:00:00</span> meteoc… CE         els Hostale… Barcelona            316 </span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> 2020-01-01 <span style="color: #949494;">00:00:00</span> meteoc… CG         Molló - Fab… Girona              <span style="text-decoration: underline;">1</span>405 </span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> 2020-01-01 <span style="color: #949494;">00:00:00</span> meteoc… CI         Sant Pau de… Girona               852 </span>
<span class="co">#&gt; <span style="color: #BCBCBC;">10</span> 2020-01-01 <span style="color: #949494;">00:00:00</span> meteoc… CJ         Organyà      Lleida               566.</span>
<span class="co">#&gt; <span style="color: #949494;"># … with 22,617 more rows, and 11 more variables: mean_temperature [°C],</span></span>
<span class="co">#&gt; <span style="color: #949494;">#   min_temperature [°C], max_temperature [°C], mean_relative_humidity [%],</span></span>
<span class="co">#&gt; <span style="color: #949494;">#   min_relative_humidity [%], max_relative_humidity [%],</span></span>
<span class="co">#&gt; <span style="color: #949494;">#   precipitation [L/m^2], mean_wind_direction [°], mean_wind_speed [m/s],</span></span>
<span class="co">#&gt; <span style="color: #949494;">#   global_solar_radiation [MJ/m^2], geometry &lt;POINT [°]&gt;</span></span>

<span class="co"># base for loop</span>
<span class="va">meteocat_2020q1_for</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="op">)</span>

<span class="kw">for</span> <span class="op">(</span><span class="va">index</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_along</a></span><span class="op">(</span><span class="va">start_dates</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">temp_res</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_meteo_from.html">get_meteo_from</a></span><span class="op">(</span>
    <span class="st">'meteocat'</span>,
    <span class="fu"><a href="../reference/services_options.html">meteocat_options</a></span><span class="op">(</span>
      api_key <span class="op">=</span> <span class="fu">keyring</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/keyring/man/key_get.html" class="external-link">key_get</a></span><span class="op">(</span><span class="st">'meteocat'</span><span class="op">)</span>,
      resolution <span class="op">=</span> <span class="st">'daily'</span>,
      start_date <span class="op">=</span> <span class="va">start_dates</span><span class="op">[</span><span class="va">index</span><span class="op">]</span>
    <span class="op">)</span>
  <span class="op">)</span>
  
  <span class="va">meteocat_2020q1_for</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="va">meteocat_2020q1_for</span>, <span class="va">temp_res</span><span class="op">)</span>
<span class="op">}</span>
<span class="va">meteocat_2020q1_for</span>
<span class="co">#&gt; Simple feature collection with 22627 features and 16 fields</span>
<span class="co">#&gt; Geometry type: POINT</span>
<span class="co">#&gt; Dimension:     XY</span>
<span class="co">#&gt; Bounding box:  xmin: 0.30565 ymin: 40.55786 xmax: 3.18165 ymax: 42.77011</span>
<span class="co">#&gt; Geodetic CRS:  WGS 84</span>
<span class="co">#&gt; <span style="color: #949494;"># A tibble: 22,627 × 17</span></span>
<span class="co">#&gt;    timestamp           service station_id station_name station_province altitude</span>
<span class="co">#&gt;  <span style="color: #BCBCBC;">*</span> <span style="color: #949494; font-style: italic;">&lt;dttm&gt;</span>              <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                 <span style="color: #949494;">[m]</span></span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> 2020-01-01 <span style="color: #949494;">00:00:00</span> meteoc… C6         Castellnou … Lleida               264 </span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> 2020-01-01 <span style="color: #949494;">00:00:00</span> meteoc… C7         Tàrrega      Lleida               427 </span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> 2020-01-01 <span style="color: #949494;">00:00:00</span> meteoc… C8         Cervera      Lleida               554 </span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> 2020-01-01 <span style="color: #949494;">00:00:00</span> meteoc… C9         Mas de Barb… Tarragona            240 </span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> 2020-01-01 <span style="color: #949494;">00:00:00</span> meteoc… CC         Orís         Barcelona            626 </span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> 2020-01-01 <span style="color: #949494;">00:00:00</span> meteoc… CD         la Seu d'Ur… Lleida               849 </span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> 2020-01-01 <span style="color: #949494;">00:00:00</span> meteoc… CE         els Hostale… Barcelona            316 </span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> 2020-01-01 <span style="color: #949494;">00:00:00</span> meteoc… CG         Molló - Fab… Girona              <span style="text-decoration: underline;">1</span>405 </span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> 2020-01-01 <span style="color: #949494;">00:00:00</span> meteoc… CI         Sant Pau de… Girona               852 </span>
<span class="co">#&gt; <span style="color: #BCBCBC;">10</span> 2020-01-01 <span style="color: #949494;">00:00:00</span> meteoc… CJ         Organyà      Lleida               566.</span>
<span class="co">#&gt; <span style="color: #949494;"># … with 22,617 more rows, and 11 more variables: mean_temperature [°C],</span></span>
<span class="co">#&gt; <span style="color: #949494;">#   min_temperature [°C], max_temperature [°C], mean_relative_humidity [%],</span></span>
<span class="co">#&gt; <span style="color: #949494;">#   min_relative_humidity [%], max_relative_humidity [%],</span></span>
<span class="co">#&gt; <span style="color: #949494;">#   precipitation [L/m^2], mean_wind_direction [°], mean_wind_speed [m/s],</span></span>
<span class="co">#&gt; <span style="color: #949494;">#   global_solar_radiation [MJ/m^2], geometry &lt;POINT [°]&gt;</span></span>

<span class="co"># both are identical</span>
<span class="fu"><a href="https://rdrr.io/r/base/identical.html" class="external-link">identical</a></span><span class="op">(</span><span class="va">meteocat_2020q1_tidyverse</span>, <span class="va">meteocat_2020q1_for</span><span class="op">)</span>
<span class="co">#&gt; [1] TRUE</span></code></pre></div>
</div>
<div class="section level3">
<h3 id="monthly">
<code>monthly</code><a class="anchor" aria-label="anchor" href="#monthly"></a>
</h3>
<p><code>monthly</code> always returns the whole year the date selected is in, i.e. for <code>start_date = as.Date('2020-04-10')</code> it will return all months in 2020:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">api_options</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/services_options.html">meteocat_options</a></span><span class="op">(</span>
  <span class="st">'monthly'</span>, start_date <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="st">'2020-04-10'</span><span class="op">)</span>,
  api_key <span class="op">=</span> <span class="fu">keyring</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/keyring/man/key_get.html" class="external-link">key_get</a></span><span class="op">(</span><span class="st">'meteocat'</span><span class="op">)</span>
<span class="op">)</span>
<span class="va">year_2020</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_meteo_from.html">get_meteo_from</a></span><span class="op">(</span><span class="st">'meteocat'</span>, <span class="va">api_options</span><span class="op">)</span>
<span class="co">#&gt; <span style="color: #BBBB00; font-weight: bold;">Data provided by meteo.cat © Servei Meteorològic de Catalunya</span></span>
<span class="co">#&gt; <span style="color: #0000BB; font-weight: bold; text-decoration: underline;">https://www.meteo.cat/wpweb/avis-legal/#info</span></span>
<span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">year_2020</span><span class="op">$</span><span class="va">timestamp</span><span class="op">)</span>
<span class="co">#&gt;  [1] "2020-01-01 UTC" "2020-02-01 UTC" "2020-03-01 UTC" "2020-04-01 UTC"</span>
<span class="co">#&gt;  [5] "2020-05-01 UTC" "2020-06-01 UTC" "2020-07-01 UTC" "2020-08-01 UTC"</span>
<span class="co">#&gt;  [9] "2020-09-01 UTC" "2020-10-01 UTC" "2020-11-01 UTC" "2020-12-01 UTC"</span></code></pre></div>
<p>Which means that if we need more than one year of monthly data, we need to use loops again:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">start_dates</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="st">'2019-01-01'</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="st">'2020-01-01'</span><span class="op">)</span>, <span class="st">'years'</span><span class="op">)</span>
<span class="co"># tidyverse map</span>
<span class="va">meteocat_2019_20_tidyverse</span> <span class="op">&lt;-</span>
  <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">map_dfr</a></span><span class="op">(</span>
    .x <span class="op">=</span> <span class="va">start_dates</span>,
    .f <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">start_date</span><span class="op">)</span> <span class="op">{</span>
      <span class="va">res</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_meteo_from.html">get_meteo_from</a></span><span class="op">(</span>
        <span class="st">'meteocat'</span>,
        <span class="fu"><a href="../reference/services_options.html">meteocat_options</a></span><span class="op">(</span>
          api_key <span class="op">=</span> <span class="fu">keyring</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/keyring/man/key_get.html" class="external-link">key_get</a></span><span class="op">(</span><span class="st">'meteocat'</span><span class="op">)</span>,
          resolution <span class="op">=</span> <span class="st">'monthly'</span>,
          start_date <span class="op">=</span> <span class="va">start_date</span>
        <span class="op">)</span>
      <span class="op">)</span>
      <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">res</span><span class="op">)</span>
    <span class="op">}</span>
  <span class="op">)</span>
<span class="co">#&gt; <span style="color: #BBBB00; font-weight: bold;">Data provided by meteo.cat © Servei Meteorològic de Catalunya</span></span>
<span class="co">#&gt; <span style="color: #0000BB; font-weight: bold; text-decoration: underline;">https://www.meteo.cat/wpweb/avis-legal/#info</span></span>
<span class="co">#&gt; <span style="color: #BBBB00; font-weight: bold;">Data provided by meteo.cat © Servei Meteorològic de Catalunya</span></span>
<span class="co">#&gt; <span style="color: #0000BB; font-weight: bold; text-decoration: underline;">https://www.meteo.cat/wpweb/avis-legal/#info</span></span>
<span class="va">meteocat_2019_20_tidyverse</span>
<span class="co">#&gt; Simple feature collection with 4502 features and 20 fields (with 11 geometries empty)</span>
<span class="co">#&gt; Geometry type: POINT</span>
<span class="co">#&gt; Dimension:     XY</span>
<span class="co">#&gt; Bounding box:  xmin: 0.30565 ymin: 40.55786 xmax: 3.18165 ymax: 42.77011</span>
<span class="co">#&gt; Geodetic CRS:  WGS 84</span>
<span class="co">#&gt; <span style="color: #949494;"># A tibble: 4,502 × 21</span></span>
<span class="co">#&gt;    timestamp           service station_id station_name station_province altitude</span>
<span class="co">#&gt;  <span style="color: #BCBCBC;">*</span> <span style="color: #949494; font-style: italic;">&lt;dttm&gt;</span>              <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                 <span style="color: #949494;">[m]</span></span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> 2019-01-01 <span style="color: #949494;">00:00:00</span> meteoc… C6         Castellnou … Lleida               264 </span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> 2019-01-01 <span style="color: #949494;">00:00:00</span> meteoc… C7         Tàrrega      Lleida               427 </span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> 2019-01-01 <span style="color: #949494;">00:00:00</span> meteoc… C8         Cervera      Lleida               554 </span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> 2019-01-01 <span style="color: #949494;">00:00:00</span> meteoc… C9         Mas de Barb… Tarragona            240 </span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> 2019-01-01 <span style="color: #949494;">00:00:00</span> meteoc… CC         Orís         Barcelona            626 </span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> 2019-01-01 <span style="color: #949494;">00:00:00</span> meteoc… CD         la Seu d'Ur… Lleida               849 </span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> 2019-01-01 <span style="color: #949494;">00:00:00</span> meteoc… CE         els Hostale… Barcelona            316 </span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> 2019-01-01 <span style="color: #949494;">00:00:00</span> meteoc… CG         Molló - Fab… Girona              <span style="text-decoration: underline;">1</span>405 </span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> 2019-01-01 <span style="color: #949494;">00:00:00</span> meteoc… CI         Sant Pau de… Girona               852 </span>
<span class="co">#&gt; <span style="color: #BCBCBC;">10</span> 2019-01-01 <span style="color: #949494;">00:00:00</span> meteoc… CJ         Organyà      Lleida               566.</span>
<span class="co">#&gt; <span style="color: #949494;"># … with 4,492 more rows, and 15 more variables: mean_temperature [°C],</span></span>
<span class="co">#&gt; <span style="color: #949494;">#   min_temperature_absolute [°C], min_temperature_mean [°C],</span></span>
<span class="co">#&gt; <span style="color: #949494;">#   max_temperature_absolute [°C], max_temperature_mean [°C],</span></span>
<span class="co">#&gt; <span style="color: #949494;">#   mean_relative_humidity [%], min_relative_humidity_absolute [%],</span></span>
<span class="co">#&gt; <span style="color: #949494;">#   min_relative_humidity_mean [%], max_relative_humidity_absolute [%],</span></span>
<span class="co">#&gt; <span style="color: #949494;">#   max_relative_humidity_mean [%], precipitation [L/m^2],</span></span>
<span class="co">#&gt; <span style="color: #949494;">#   mean_wind_direction [°], mean_wind_speed [m/s], …</span></span>

<span class="co"># base for loop</span>
<span class="va">meteocat_2019_20_for</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="op">)</span>

<span class="kw">for</span> <span class="op">(</span><span class="va">index</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_along</a></span><span class="op">(</span><span class="va">start_dates</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">temp_res</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_meteo_from.html">get_meteo_from</a></span><span class="op">(</span>
    <span class="st">'meteocat'</span>,
    <span class="fu"><a href="../reference/services_options.html">meteocat_options</a></span><span class="op">(</span>
      api_key <span class="op">=</span> <span class="fu">keyring</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/keyring/man/key_get.html" class="external-link">key_get</a></span><span class="op">(</span><span class="st">'meteocat'</span><span class="op">)</span>,
      resolution <span class="op">=</span> <span class="st">'monthly'</span>,
      start_date <span class="op">=</span> <span class="va">start_dates</span><span class="op">[</span><span class="va">index</span><span class="op">]</span>
    <span class="op">)</span>
  <span class="op">)</span>
  
  <span class="va">meteocat_2019_20_for</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="va">meteocat_2019_20_for</span>, <span class="va">temp_res</span><span class="op">)</span>
<span class="op">}</span>
<span class="va">meteocat_2019_20_for</span>
<span class="co">#&gt; Simple feature collection with 4502 features and 20 fields (with 11 geometries empty)</span>
<span class="co">#&gt; Geometry type: POINT</span>
<span class="co">#&gt; Dimension:     XY</span>
<span class="co">#&gt; Bounding box:  xmin: 0.30565 ymin: 40.55786 xmax: 3.18165 ymax: 42.77011</span>
<span class="co">#&gt; Geodetic CRS:  WGS 84</span>
<span class="co">#&gt; <span style="color: #949494;"># A tibble: 4,502 × 21</span></span>
<span class="co">#&gt;    timestamp           service station_id station_name station_province altitude</span>
<span class="co">#&gt;  <span style="color: #BCBCBC;">*</span> <span style="color: #949494; font-style: italic;">&lt;dttm&gt;</span>              <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                 <span style="color: #949494;">[m]</span></span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> 2019-01-01 <span style="color: #949494;">00:00:00</span> meteoc… C6         Castellnou … Lleida               264 </span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> 2019-01-01 <span style="color: #949494;">00:00:00</span> meteoc… C7         Tàrrega      Lleida               427 </span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> 2019-01-01 <span style="color: #949494;">00:00:00</span> meteoc… C8         Cervera      Lleida               554 </span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> 2019-01-01 <span style="color: #949494;">00:00:00</span> meteoc… C9         Mas de Barb… Tarragona            240 </span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> 2019-01-01 <span style="color: #949494;">00:00:00</span> meteoc… CC         Orís         Barcelona            626 </span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> 2019-01-01 <span style="color: #949494;">00:00:00</span> meteoc… CD         la Seu d'Ur… Lleida               849 </span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> 2019-01-01 <span style="color: #949494;">00:00:00</span> meteoc… CE         els Hostale… Barcelona            316 </span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> 2019-01-01 <span style="color: #949494;">00:00:00</span> meteoc… CG         Molló - Fab… Girona              <span style="text-decoration: underline;">1</span>405 </span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> 2019-01-01 <span style="color: #949494;">00:00:00</span> meteoc… CI         Sant Pau de… Girona               852 </span>
<span class="co">#&gt; <span style="color: #BCBCBC;">10</span> 2019-01-01 <span style="color: #949494;">00:00:00</span> meteoc… CJ         Organyà      Lleida               566.</span>
<span class="co">#&gt; <span style="color: #949494;"># … with 4,492 more rows, and 15 more variables: mean_temperature [°C],</span></span>
<span class="co">#&gt; <span style="color: #949494;">#   min_temperature_absolute [°C], min_temperature_mean [°C],</span></span>
<span class="co">#&gt; <span style="color: #949494;">#   max_temperature_absolute [°C], max_temperature_mean [°C],</span></span>
<span class="co">#&gt; <span style="color: #949494;">#   mean_relative_humidity [%], min_relative_humidity_absolute [%],</span></span>
<span class="co">#&gt; <span style="color: #949494;">#   min_relative_humidity_mean [%], max_relative_humidity_absolute [%],</span></span>
<span class="co">#&gt; <span style="color: #949494;">#   max_relative_humidity_mean [%], precipitation [L/m^2],</span></span>
<span class="co">#&gt; <span style="color: #949494;">#   mean_wind_direction [°], mean_wind_speed [m/s], …</span></span>

<span class="co"># both are identical</span>
<span class="fu"><a href="https://rdrr.io/r/base/identical.html" class="external-link">identical</a></span><span class="op">(</span><span class="va">meteocat_2019_20_tidyverse</span>, <span class="va">meteocat_2019_20_for</span><span class="op">)</span>
<span class="co">#&gt; [1] TRUE</span></code></pre></div>
</div>
<div class="section level3">
<h3 id="yearly">
<code>yearly</code><a class="anchor" aria-label="anchor" href="#yearly"></a>
</h3>
<p><code>yearly</code> always returns all available years and <code>start_date</code> argument is ignored, i.e. using <code>start_date = as.Date('2020-04-10')</code> will return all years, independently of the date supplied:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">api_options</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/services_options.html">meteocat_options</a></span><span class="op">(</span>
  <span class="st">'yearly'</span>, start_date <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="st">'2020-04-10'</span><span class="op">)</span>,
  api_key <span class="op">=</span> <span class="fu">keyring</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/keyring/man/key_get.html" class="external-link">key_get</a></span><span class="op">(</span><span class="st">'meteocat'</span><span class="op">)</span>
<span class="op">)</span>
<span class="va">all_years</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_meteo_from.html">get_meteo_from</a></span><span class="op">(</span><span class="st">'meteocat'</span>, <span class="va">api_options</span><span class="op">)</span>
<span class="co">#&gt; <span style="color: #BBBB00; font-weight: bold;">Data provided by meteo.cat © Servei Meteorològic de Catalunya</span></span>
<span class="co">#&gt; <span style="color: #0000BB; font-weight: bold; text-decoration: underline;">https://www.meteo.cat/wpweb/avis-legal/#info</span></span>
<span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">all_years</span><span class="op">$</span><span class="va">timestamp</span><span class="op">)</span>
<span class="co">#&gt;  [1] "2008-05-24 UTC" "2009-05-24 UTC" "2010-05-24 UTC" "2011-05-24 UTC"</span>
<span class="co">#&gt;  [5] "2012-05-24 UTC" "2013-05-24 UTC" "2014-05-24 UTC" "2015-05-24 UTC"</span>
<span class="co">#&gt;  [9] "2016-05-24 UTC" "2017-05-24 UTC" "2018-05-24 UTC" "2019-05-24 UTC"</span>
<span class="co">#&gt; [13] "2020-05-24 UTC" "2021-05-24 UTC"</span></code></pre></div>
<p>This means that with yearly we always get all the data available, so there is no need of loops.</p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Victor Granda.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.3.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
