<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Contributing to meteospain • meteospain</title>


<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
<!-- Bootstrap -->

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous" />

<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script>

<!-- bootstrap-toc -->
<link rel="stylesheet" href="bootstrap-toc.css">
<script src="bootstrap-toc.js"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="pkgdown.css" rel="stylesheet">
<script src="pkgdown.js"></script>




<meta property="og:title" content="Contributing to meteospain" />




<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->



  </head>

  <body data-spy="scroll" data-target="#toc">
    <div class="container template-title-body">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="index.html">meteospain</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.0.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li class="divider"></li>
    <li class="dropdown-header">Services</li>
    <li>
      <a href="articles/aemet.html">AEMET service</a>
    </li>
    <li>
      <a href="articles/meteocat.html">MeteoCat service</a>
    </li>
    <li>
      <a href="articles/meteogalicia.html">MeteoGalicia service</a>
    </li>
    <li>
      <a href="articles/meteoclimatic.html">Meteoclimatic service</a>
    </li>
    <li class="divider"></li>
    <li class="dropdown-header">Workflows</li>
    <li>
      <a href="articles/api_limits.html">API limits and loops</a>
    </li>
    <li>
      <a href="articles/compatibility.html">Compatibility betweeen services</a>
    </li>
  </ul>
</li>
<li>
  <a href="news/index.html">Changelog</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/emf-creaf/meteospain/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="contents col-md-9">
    <div class="page-header">
      <h1>Contributing to meteospain</h1>
    </div>

<div id="contributing-to-meteospain" class="section level1">

<p>This outlines how to propose a change to meteospain.</p>
<div id="bigger-changes" class="section level2">
<h2 class="hasAnchor">
<a href="#bigger-changes" class="anchor"></a>Bigger changes</h2>
<p>If you want to make a bigger change, it’s a good idea to first file an issue and make sure someone from the team agrees that it’s needed. If you’ve found a bug, please file an issue that illustrates the bug with a minimal <a href="https://www.tidyverse.org/help/#reprex">reprex</a> (this will also help you write a unit test, if needed).</p>
<div id="pull-request-process" class="section level3">
<h3 class="hasAnchor">
<a href="#pull-request-process" class="anchor"></a>Pull request process</h3>
<ul>
<li><p>Fork the package and clone onto your computer. If you haven’t done this before, we recommend using <code>usethis::create_from_github("emf-creaf/meteospain", fork = TRUE)</code>.</p></li>
<li><p>Install all development dependences with <code>devtools::install_dev_deps()</code>, and then make sure the package passes R CMD check by running <code>devtools::check()</code>. If R CMD check doesn’t pass cleanly, it’s a good idea to ask for help before continuing.</p></li>
<li><p>For passing tests and building vignettes, you will need API keys for AEMET and MeteoCat (see <code><a href="reference/services_options.html">?services_options</a></code>). A workaround to develop without those keys is setting the <code>NOT_CRAN</code> environment variable to <code>false</code> (<code><a href="https://rdrr.io/r/base/Sys.setenv.html">Sys.setenv(NOT_CRAN = 'false')</a></code>), but with this, most of the tests and examples will be not run when building, testing and checking.</p></li>
<li><p>Create a Git branch for your pull request (PR). We recommend using <code>usethis::pr_init("brief-description-of-change")</code>.</p></li>
<li><p>Make your changes, commit to git, and then create a PR by running <code>usethis::pr_push()</code>, and following the prompts in your browser. The title of your PR should briefly describe the change. The body of your PR should contain <code>Fixes #issue-number</code>.</p></li>
<li><p>For user-facing changes, add a bullet to the top of <code>NEWS.md</code> (i.e. just below the first header). Follow the style described in <a href="https://style.tidyverse.org/news.html" class="uri">https://style.tidyverse.org/news.html</a>.</p></li>
</ul>
</div>
<div id="code-style" class="section level3">
<h3 class="hasAnchor">
<a href="#code-style" class="anchor"></a>Code style</h3>
<ul>
<li><p>We use <a href="https://cran.r-project.org/package=roxygen2">roxygen2</a>, with <a href="https://cran.r-project.org/web/packages/roxygen2/vignettes/rd-formatting.html">Markdown syntax</a>, for documentation.</p></li>
<li><p>We use <a href="https://cran.r-project.org/package=testthat">testthat</a> for unit tests. Contributions with test cases included are easier to accept.</p></li>
</ul>
</div>
<div id="dependencies" class="section level3">
<h3 class="hasAnchor">
<a href="#dependencies" class="anchor"></a>Dependencies</h3>
<p>Any interaction with a meteorological API must be done with <code>httr</code> and/or <code>jsonlite</code> and/or <code>xml2</code>, as they are already dependencies of <code>meteospain</code>. See DESCRIPTION file for a list of available dependencies.</p>
</div>
</div>
<div id="service-code-guide" class="section level2">
<h2 class="hasAnchor">
<a href="#service-code-guide" class="anchor"></a>Service code guide</h2>
<p>When adding a new service to <code>meteospain</code>, there are some conventions to follow:</p>
<div id="helpers" class="section level3">
<h3 class="hasAnchor">
<a href="#helpers" class="anchor"></a>Helpers</h3>
<p>Each service has an R file associated, <code>[service_name]_helpers.R</code>. In this file we will put all helpers needed to access the service API:</p>
<ul>
<li><p><code>.create_[service]_path(api_options)</code>: to build the vector with the path, usually depending on the temporal resolution.</p></li>
<li><p><code>.create_[service]_query(api_options)</code>: some APIs need the parameters supplied as queries.</p></li>
<li><p><code>.check_status_[service](api_options)</code>: logic to check the response statuses (200, 429, 500…).</p></li>
<li><p><code>.get_info_[service](api_options)</code>: Access, transform and return the stations info and metadata.</p></li>
<li><p><code>.get_data_[service](api_options)</code>: Access, transform and return the data based on the api options provided (temporal resolution, stations…). This function will use the <code>.create_*</code> and <code>.check_status_[service]</code> helpers.</p></li>
</ul>
<p>Data must be transformed to sf, adding the stations metadata. Numerical data must be converted to units and variables names standardized among all services.</p>
</div>
<div id="options" class="section level3">
<h3 class="hasAnchor">
<a href="#options" class="anchor"></a>Options</h3>
<p>Each service must have a dedicated function to create the API options, <code>[service]_options</code>. This function will control which parameters are needed:</p>
<ul>
<li>
<code>resolution</code>: Temporal resolution for the data (hourly, daily…), used to build paths, queries…</li>
<li>
<code>start_date</code>: Starting date for the desired data, used to build paths, queries…. If the API only accepts one date (see MeteoCat for example), use this one.</li>
<li>
<code>end_date</code>: End date for the desired data, used to build paths, queries…. If the API only accepts one date, this argument is not necessary.</li>
<li>
<code>stations</code>: Character vector with stations IDs to use in paths or queries before retrieving the data or filters after.</li>
</ul>
<blockquote>
<p>NOTE: When the API only accepts one station when querying by stations, but there is a path to obtain all stations, this one must be used and the desired stations filtered afterwards. This way we reduce the calls to the API, as we dont need to create a loop to return every station in <code>stations</code> argument. If no path exists for getting data from all stations, then a loop should be used.</p>
</blockquote>
<ul>
<li>
<code>api_key</code>: If the API needs a key, add this argument for the user to supply the key.</li>
</ul>
<blockquote>
<p>NOTE: <code>meteospain</code> does not store or encrypt in any way the supplied key. Is the user responsability to manage their keys. We recommend the keyring package for this in all docs and functions help.</p>
</blockquote>
</div>
<div id="tests" class="section level3">
<h3 class="hasAnchor">
<a href="#tests" class="anchor"></a>Tests</h3>
<p><code>tests/testthat/test-concordance_between_services.R</code> adds tests for joining data between services.</p>
<p><code>tests/testthat/test-[service].R</code> adds tests for each service.</p>
<p>In <code>utils.R</code> there is a helper function for the main test battery applied to each service: <code>main_test_battery()</code>. See examples of use in the test files of services already implemented.</p>
</div>
</div>
</div>

  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top">
      <h2 data-toc-skip>Contents</h2>
    </nav>
  </div>

</div>



      <footer>
      <div class="copyright">
  <p>Developed by Victor Granda.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
   </div>

  


  </body>
</html>


